<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        table {
            font-family: verdana, arial, sans-serif;
            font-size: 11px;
            color: #333333;
            border-width: 1px;
            border-color: #666666;
            border-collapse: collapse;
        }

        th {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #dedede;
        }

        td {
            border-width: 1px;
            padding: 8px;
            border-style: solid;
            border-color: #666666;
            background-color: #ffffff;
        }

        input[type = "text"] {
            border: none;
            width: 100%
        }
    </style>
    <script th:src="@{/js/jquery.js}"></script>
    <script>
        $(document).ready(function () {
            //添加，页面增加新的空行
            $('#insert').click(function () {
                var tr = '<tr>\n' +
                    '            <input type="hidden" name="id" >\n' +
                    '            <input type="hidden" name="modelStatus" value="2">' +
                    '            <td align="center">\n' +
                    '                <input type="radio" name="dr" class="dr">\n' +
                    '            </td>\n' +
                    '            <td >\n' +
                    '            </td>\n' +
                    '            <td>\n' +
                    '                <input type="text" name="itemCode" class="si" placeholder="必填">\n' +
                    '            </td>\n' +
                    '            <td>\n' +
                    '                <input type="text" name="itemName" class="si" placeholder="必填">\n' +
                    '            </td>\n' +
                    '            <td>\n' +
                    '                <input type="text" name="introduction" class="si" >\n' +
                    '            </td>\n' +
                    '            <td align="center">\n' +
                    '                <input type="checkbox" name="enable" value="3" class="si" >\n' +
                    '            </td>\n' +
                    '        </tr>';
                $(" table").append(tr);
            });
            //获取表格的修改状态
            $(".si").change(function () {
                var hidden = $(this).parent().parent().children("input:last");
                if (hidden.val() == 0) {
                    hidden.val(1);
                }
            });
            //保存，保存修改和添加的数据
            $.fn.serializeJson = function () {
                var jsonData1 = {};
                var serializeArray = this.serializeArray();
                // 先转换成{"id": ["12","14"], "name": ["aaa","bbb"], "pwd":["pwd1","pwd2"]}这种形式
                $(serializeArray).each(function () {
                    if (jsonData1[this.name]) {
                        if ($.isArray(jsonData1[this.name])) {
                            jsonData1[this.name].push(this.value);
                        } else {
                            jsonData1[this.name] = [jsonData1[this.name], this.value];
                        }
                    } else {
                        jsonData1[this.name] = this.value;
                    }
                });
                // 再转成[{"id": "12", "name": "aaa", "pwd":"pwd1"},{"id": "14", "name": "bb", "pwd":"pwd2"}]的形式
                var vCount = 0;
                // 计算json内部的数组最大长度
                for (var item in jsonData1) {
                    var tmp = $.isArray(jsonData1[item]) ? jsonData1[item].length : 1;
                    vCount = (tmp > vCount) ? tmp : vCount;
                }
                if (vCount > 1) {
                    var jsonData2 = new Array();
                    for (var i = 0; i < vCount; i++) {
                        var jsonObj = {};
                        for (var item in jsonData1) {
                            jsonObj[item] = jsonData1[item][i];
                        }
                        jsonData2.push(jsonObj);
                    }
                    return JSON.stringify(jsonData2);
                } else {
                    return "[" + JSON.stringify(jsonData1) + "]";
                }
            };
            $('#save').click(function () {
                $('#saveSalaryItemForm :radio').removeAttr("name");
                var jsonStr = $('#saveSalaryItemForm').serializeJson();
                $.ajax({
                    type: "POST",
                    url: "/saveSalaryItem",
                    contentType: "application/json;charset=utf-8",
                    data: jsonStr,
                    success: function (data) {
                        if (data == "success") {
                            window.location.reload();
                            alert("保存成功");
                        } else if (data == "error") {
                            alert("保存失败");
                        }
                    }
                });
            });
            //删除，异步删除，并remove元素
            $('#delete').click(function () {
                var radio = $('#saveSalaryItemForm :radio:checked');
                var id = radio.val();
                if (confirm("确认删除吗?")) {
                    $.get("deleteSalaryItem", {"id": id}, function (data) {
                        if (data == "success") {
                            radio.parent().parent().remove();
                            alert("删除成功!");
                        } else {
                            alert("出现了一点小错误");
                        }
                    });
                }
            });
            //撤销
            $('#cancel').click(function () {
                if (confirm("此操作将取消所有未保存的操作（修改、新增），确定取消这些操作吗？")) {
                    window.location.reload();
                }
            });
        });

    </script>
</head>
<body>
<button id="insert">新增</button>
<button id="save">保存</button>
<button id="cancel">取消</button>
<button id="delete">删除</button>
<form name="salaryItemList" id="saveSalaryItemForm">
    <table id="salaryItemTable">
        <thead>
        <th>选择</th>
        <th>序号</th>
        <th>薪酬项目编码</th>
        <th>薪酬项目名称</th>
        <th>薪酬项目描述</th>
        <th>是否启用</th>
        </thead>
        <tbody>
        <tr th:each="salaryItem,status:${salaryItemList}">
            <input type="hidden" th:name="id" th:value="${salaryItem.getId()}">
            <input type="hidden" th:name="modelStatus" value="0">
            <td align="center">
                <input type="radio" class="dr" name="dr" th:value="${salaryItem.getId()}">
            </td>
            <td th:text="${status.count}">
            </td>
            <td>
                <input type="text" th:name="itemCode" th:value="${salaryItem.getItemCode()}" class="si"
                       placeholder="必填">
            </td>
            <td>
                <input type="text" th:name="itemName" th:value="${salaryItem.getItemName()}" class="si"
                       placeholder="必填">
            </td>
            <td>
                <input type="text" th:name="introduction" th:value="${salaryItem.getIntroduction()}" class="si"
                >
            </td>
            <td th:if="${salaryItem.getEnable()}==3" align="center">
                <input type="checkbox" th:name="enable"
                       checked="checked" value="3" class="si">
            </td>
            <td th:if="${salaryItem.getEnable()}==4" align="center">
                <input type="checkbox" th:name="enable" value="3" class="si">
            </td>
        </tr>
        </tbody>
    </table>
</form>
</body>
</html>